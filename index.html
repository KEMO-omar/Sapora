<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sapora Rocket - Professional Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #4361ee; --accent: #ff4757; --dark: #0f172a; 
            --glass: rgba(255, 255, 255, 0.95); --shadow: 0 10px 30px rgba(0,0,0,0.15); 
        }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Cairo', sans-serif; background: #f8fafc; touch-action: none; user-select: none; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #auth-screen { position: fixed; inset: 0; background: #0f172a; z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .card { background: white; padding: 40px; border-radius: 25px; width: 90%; max-width: 400px; text-align: center; box-shadow: var(--shadow); }
        .input-group { margin-bottom: 15px; }
        .input-group input { width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #eee; outline: none; font-family: 'Cairo'; box-sizing: border-box; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª */
        #main-toolbar { 
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: var(--glass); padding: 10px 20px; border-radius: 50px; 
            display: none; gap: 15px; align-items: center; z-index: 2000; box-shadow: var(--shadow); border: 1px solid #ddd;
        }
        .tool-btn { width: 45px; height: 45px; border-radius: 50%; border: none; background: #f1f5f9; cursor: pointer; color: #444; font-size: 18px; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .tool-btn:hover { background: #e2e8f0; }
        .tool-btn.active { background: var(--primary); color: white; }

        /* Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ© */
        .sub-menu { position: absolute; bottom: 70px; background: white; padding: 15px; border-radius: 20px; display: none; box-shadow: var(--shadow); border: 1px solid #eee; }
        .show { display: flex !important; }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ù„ÙˆØ§Ù† (10 Ø£Ù„ÙˆØ§Ù†) */
        .color-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .color-dot { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid #fff; box-shadow: 0 0 5px rgba(0,0,0,0.1); }

        #board { background: white; cursor: crosshair; }
        .top-info { position: fixed; top: 15px; right: 20px; z-index: 1000; background: var(--glass); padding: 5px 15px; border-radius: 10px; font-weight: bold; box-shadow: var(--shadow); }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="card">
            <h2 style="color: var(--primary)">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø·Ù„ ğŸš€</h2>
            <div class="input-group">
                <input type="text" id="userName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ">
            </div>
            <div id="teacher-pass-group" class="input-group" style="display:none;">
                <input type="password" id="adminPass" placeholder="ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø¹Ù„Ù…">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button onclick="app.login('student')" style="background:#10b981; color:white; border:none; padding:12px; border-radius:10px; cursor:pointer;">Ø¯Ø®ÙˆÙ„ Ø·Ø§Ù„Ø¨</button>
                <button onclick="document.getElementById('teacher-pass-group').style.display='block'" style="background:var(--primary); color:white; border:none; padding:12px; border-radius:10px; cursor:pointer;">Ø£Ù†Ø§ Ø§Ù„Ù…Ø¹Ù„Ù…</button>
            </div>
            <button id="final-teacher-btn" onclick="app.login('teacher')" style="display:none; width:100%; margin-top:10px; background:var(--dark); color:white; border:none; padding:12px; border-radius:10px; cursor:pointer;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¹Ù„Ù…</button>
        </div>
    </div>

    <div class="top-info" id="user-display" style="display:none;">
        <i class="fas fa-user"></i> <span id="active-name"></span>
    </div>

    <div id="main-toolbar">
        <div style="position:relative;">
            <button class="tool-btn" id="color-trigger" onclick="app.toggleMenu('color-menu')"><i class="fas fa-palette"></i></button>
            <div id="color-menu" class="sub-menu">
                <div class="color-grid">
                    <div class="color-dot" style="background:#000000" onclick="app.setColor('#000000')"></div>
                    <div class="color-dot" style="background:#ff4757" onclick="app.setColor('#ff4757')"></div>
                    <div class="color-dot" style="background:#2ed573" onclick="app.setColor('#2ed573')"></div>
                    <div class="color-dot" style="background:#1e90ff" onclick="app.setColor('#1e90ff')"></div>
                    <div class="color-dot" style="background:#ffa502" onclick="app.setColor('#ffa502')"></div>
                    <div class="color-dot" style="background:#a55eea" onclick="app.setColor('#a55eea')"></div>
                    <div class="color-dot" style="background:#4b4b4b" onclick="app.setColor('#4b4b4b')"></div>
                    <div class="color-dot" style="background:#ff6b81" onclick="app.setColor('#ff6b81')"></div>
                    <div class="color-dot" style="background:#2f3542" onclick="app.setColor('#2f3542')"></div>
                    <div class="color-dot" style="background:#747d8c" onclick="app.setColor('#747d8c')"></div>
                </div>
            </div>
        </div>

        <button class="tool-btn active" id="btn-pen" onclick="app.setMode('pen')"><i class="fas fa-pen"></i></button>
        <button class="tool-btn" id="btn-eraser" onclick="app.setMode('eraser')"><i class="fas fa-eraser"></i></button>
        <button class="tool-btn" onclick="app.clear()"><i class="fas fa-trash-alt" style="color:red"></i></button>
        <button class="tool-btn" onclick="app.undo()"><i class="fas fa-undo"></i></button>
        <button class="tool-btn" onclick="app.toggleFullscreen()"><i class="fas fa-expand"></i></button>
    </div>

    <canvas id="board"></canvas>

    <script>
        const app = {
            canvas: document.getElementById('board'),
            ctx: document.getElementById('board').getContext('2d'),
            isDrawing: false,
            mode: 'pen',
            color: '#000000',
            isAdmin: false,
            history: [],

            init() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                this.setupEvents();
                
                // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø²Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
                document.getElementById('adminPass').addEventListener('input', (e) => {
                    document.getElementById('final-teacher-btn').style.display = e.target.value ? 'block' : 'none';
                });
            },

            login(role) {
                const name = document.getElementById('userName').value;
                if(!name) return alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ");

                if(role === 'teacher') {
                    const pass = document.getElementById('adminPass').value;
                    if(pass !== "1234") return alert("ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø¹Ù„Ù… Ø®Ø·Ø£!");
                    this.isAdmin = true;
                }

                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('main-toolbar').style.display = 'flex';
                document.getElementById('user-display').style.display = 'block';
                document.getElementById('active-name').innerText = name + (this.isAdmin ? " (Ù…Ø¹Ù„Ù…)" : " (Ø·Ø§Ù„Ø¨)");
            },

            setupEvents() {
                const getPos = (e) => {
                    const rect = this.canvas.getBoundingClientRect();
                    return {
                        x: (e.clientX || e.touches[0].clientX) - rect.left,
                        y: (e.clientY || e.touches[0].clientY) - rect.top
                    };
                };

                const start = (e) => {
                    if(!this.isAdmin) return; // Ø§Ù„Ø·Ø§Ù„Ø¨ Ù„Ø§ ÙŠØ±Ø³Ù…
                    this.isDrawing = true;
                    this.closeMenus();
                    const pos = getPos(e);
                    this.ctx.beginPath();
                    this.ctx.moveTo(pos.x, pos.y);
                };

                const move = (e) => {
                    if(!this.isDrawing) return;
                    const pos = getPos(e);
                    this.ctx.lineTo(pos.x, pos.y);
                    this.ctx.strokeStyle = this.mode === 'eraser' ? '#ffffff' : this.color;
                    this.ctx.lineWidth = this.mode === 'eraser' ? 30 : 3;
                    this.ctx.lineCap = 'round';
                    this.ctx.stroke();
                };

                const stop = () => {
                    if(this.isDrawing) {
                        this.isDrawing = false;
                        this.history.push(this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height));
                    }
                };

                this.canvas.addEventListener('mousedown', start);
                this.canvas.addEventListener('mousemove', move);
                window.addEventListener('mouseup', stop);

                this.canvas.addEventListener('touchstart', start);
                this.canvas.addEventListener('touchmove', move);
                window.addEventListener('touchend', stop);
            },

            toggleMenu(id) {
                const el = document.getElementById(id);
                const isShown = el.classList.contains('show');
                this.closeMenus();
                if(!isShown) el.classList.add('show');
            },

            closeMenus() {
                document.querySelectorAll('.sub-menu').forEach(m => m.classList.remove('show'));
            },

            setColor(c) {
                this.color = c;
                document.getElementById('color-trigger').style.color = c;
                this.setMode('pen');
                this.closeMenus();
            },

            setMode(m) {
                this.mode = m;
                document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
                document.getElementById('btn-' + m).classList.add('active');
            },

            undo() {
                if(this.history.length > 0) {
                    this.history.pop();
                    if(this.history.length === 0) {
                        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                    } else {
                        this.ctx.putImageData(this.history[this.history.length - 1], 0, 0);
                    }
                }
            },

            clear() {
                if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¨ÙˆØ±Ø©ØŸ")) {
                    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                    this.history = [];
                }
            },

            toggleFullscreen() {
                if (!document.fullscreenElement) document.documentElement.requestFullscreen();
                else document.exitFullscreen();
            }
        };

        app.init();
    </script>
</body>
</html>
